# CodeQL Query Configuration for Game Development
# Optimized for C# MonoGame/Android projects

query_suites:
  - name: "csharp-security-and-quality"
    description: "Standard C# security and quality queries"
    enabled: true
    
  - name: "csharp-code-scanning"
    description: "GitHub code scanning queries"
    enabled: true

custom_queries:
  # Game-specific security patterns
  - name: "game-input-validation"
    description: "Validate game input handling"
    query: |
      import csharp
      
      from Method m, Parameter p
      where m.getName().matches("%Input%") or m.getName().matches("%Touch%")
        and p = m.getAParameter()
        and not exists(IfStmt guard | guard.getEnclosingCallable() = m)
      select m, "Game input method $@ lacks input validation", m, m.getName()
    
  - name: "resource-leak-detection"
    description: "Detect potential resource leaks in game code"
    query: |
      import csharp
      
      from ObjectCreation oc, Type t
      where t = oc.getType()
        and (t.getName().matches("%Texture%") or 
             t.getName().matches("%Buffer%") or
             t.getName().matches("%Stream%"))
        and not exists(UsingStmt us | us.getAChild*() = oc)
        and not exists(MethodCall dispose | 
             dispose.getTarget().getName() = "Dispose" and
             dispose.getQualifier().getType() = t)
      select oc, "Potential resource leak: $@ may not be properly disposed", oc, t.getName()

exclusions:
  # Exclude common false positive patterns
  patterns:
    - "**/*Test*.cs"           # Test files
    - "**/bin/**"              # Build output
    - "**/obj/**"              # Build intermediates
    - "**/packages/**"         # NuGet packages
    - "**/Content/bin/**"      # MonoGame content output
    
  rules:
    # MonoGame framework patterns
    - rule_id: "cs/unused-local-variable"
      file_pattern: ".*/(Game1|Activity1)\\.cs"
      reason: "MonoGame framework variables"
      
    - rule_id: "cs/unused-method"
      method_pattern: "(Update|Draw|LoadContent|Initialize)"
      reason: "MonoGame lifecycle methods"
      
    # Android framework patterns  
    - rule_id: "cs/unused-method"
      method_pattern: "(OnCreate|OnResume|OnPause|OnDestroy)"
      reason: "Android lifecycle methods"
      
    # OpenGL/Graphics patterns
    - rule_id: "cs/resource-not-disposed"
      message_pattern: "(GL|OpenGL|Texture|Buffer)"
      reason: "Graphics resources managed by driver"

severity_overrides:
  # Reduce severity for game-specific patterns
  - rule_id: "cs/unused-local-variable"
    file_pattern: ".*Graphics.*\\.cs"
    new_severity: "note"
    reason: "Graphics code often has temporary variables"
    
  - rule_id: "cs/empty-catch-block"
    file_pattern: ".*Content.*\\.cs"
    new_severity: "warning"
    reason: "Content loading may need graceful failure handling"

game_specific_checks:
  # Performance-critical patterns for games
  - name: "allocation-in-update-loop"
    description: "Detect allocations in game update loops"
    severity: "warning"
    pattern: "new.*in Update/Draw methods"
    
  - name: "string-concatenation-in-loop"
    description: "String concatenation in game loops"
    severity: "info"
    pattern: "string + in Update/Draw methods"
    
  - name: "boxing-in-game-loop"
    description: "Boxing operations in performance-critical code"
    severity: "warning"
    pattern: "value type boxing in Update/Draw"
